<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalentFlow - Oportunidades</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top glass-card mx-3 mt-3 rounded-pill" style="border-radius: 50px !important;">
            <div class="container-fluid px-4">
                <a class="navbar-brand fw-bold" href="#"><i class="bi bi-person-workspace me-2"></i>TalentFlow <span class="badge bg-info small">Vagas</span></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#candNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="candNav">
                    <ul class="navbar-nav ms-auto align-items-center gap-3">
                        <li class="nav-item"><a class="nav-link active" href="index.html" onclick="showSection('inicio')">Início</a></li>
                        <li class="nav-item ms-3">
                            <a href="index.html" class="btn btn-outline-light rounded-pill px-3 btn-sm hover-scale">Entrar</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <br><br><br><br><br>
        
        <section class="filtros-area">
            <input type="text" id="inputBusca" placeholder="Pesquisar cargo..." oninput="listar()">
            
            <select id="selectEmpresa" onchange="listar()">
                <option value="0">Todas as Empresas</option>
            </select>
            <script>
                let vagas=[];

                async function getVagas() {
                    try {
                    // Backend espera JSON no Body
                        const response = await fetch('http://localhost:8080/vagas', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });

                        if (response.ok) {
                            console.log()
                            vagas = await response.json();
                            console.log(vagas);
                            
                            popularEmpresas();

                            vagas.forEach(vaga => {
                                console.log(vaga);
                            
                                //// CONTAINER DA VAGA
                                const vagaDiv = document.createElement('div');
                                vagaDiv.classList.add('vaga-item','glass-card', 'p-4', 'mb-3');
                                //// LINK DA VAGA
                                const vagaLink = document.createElement('a');
                                vagaLink.href = `index.html`;
                                vagaLink.classList.add('vaga-link')
                                vagaLink.appendChild(vagaDiv);
                                document.getElementById('vagasGrid').appendChild(vagaLink);
                                //// TÍTULO
                                const vagaTitulo = document.createElement('h3');
                                vagaTitulo.textContent = vaga.titulo;                                
                                vagaTitulo.classList.add('vaga-titulo','fw-bold', 'h4');
                                vagaDiv.appendChild(vagaTitulo);
                                //// DESCRIÇÃO
                                const vagaDescricao = document.createElement('p');
                                vagaDescricao.textContent = vaga.descricao;
                                vagaDescricao.classList.add('small', 'text-white-50');
                                vagaDescricao.classList.add('vaga-descricao');
                                vagaDiv.appendChild(vagaDescricao);
                                //// ÁREA
                                const vagaArea = document.createElement('p');
                                vagaArea.textContent = vaga.area;
                                vagaDiv.appendChild(vagaArea);
                                //// EMPRESA
                                const vagaEmpresa = document.createElement('p');
                                vagaEmpresa.textContent = vaga.empresa.nome;
                                vagaDiv.appendChild(vagaEmpresa);

                                

                            });
                        } 
                        else
                        {
                            console.log('Erro ao obter as vagas do servidor.');                            
                        }
                    } catch (error) {
                        console.log('Erro ao conectar com o servidor.');
                        console.error(error);
                    } 
                }


                function listar() {
                    // 1. Limpa o grid para a nova filtragem (ou reversão)
                    const grid = document.getElementById('vagasGrid');
                    grid.innerHTML = "";

                    // 2. Captura os valores dos inputs
                    const pesquisa = document.getElementById('inputBusca').value.toLowerCase();
                    const empresaFiltro = document.getElementById('selectEmpresa').value;

                    // 3. Filtra a partir da variável global 'vagas' (isso garante a reversão)
                    const vagasFiltradas = vagas.filter(vaga => {
                        const matchesTexto = vaga.titulo.toLowerCase().includes(pesquisa) || 
                                            vaga.descricao.toLowerCase().includes(pesquisa);
                        const matchesEmpresa = empresaFiltro === "" || 
                                            vaga.empresa.nome === empresaFiltro;
                        return matchesTexto && matchesEmpresa;
                    });

                    // 4. Cria o HTML no próprio listar()
                    vagasFiltradas.forEach(vaga => {
                        const vagaDiv = document.createElement('div');
                        vagaDiv.classList.add('vaga-item','glass-card', 'p-4', 'mb-3');
                        
                        const vagaLink = document.createElement('a');
                        vagaLink.href = `index.html`;
                        vagaLink.classList.add('vaga-link');
                        
                        const vagaTitulo = document.createElement('h3');
                        vagaTitulo.textContent = vaga.titulo;                                
                        vagaTitulo.classList.add('vaga-titulo','fw-bold', 'h4');
                        vagaDiv.appendChild(vagaTitulo);
                        
                        const vagaDescricao = document.createElement('p');
                        vagaDescricao.textContent = vaga.descricao;
                        vagaDescricao.classList.add('small', 'text-white-50', 'vaga-descricao');
                        vagaDiv.appendChild(vagaDescricao);
                        
                        const vagaArea = document.createElement('p');
                        vagaArea.textContent = vaga.area;
                        vagaDiv.appendChild(vagaArea);
                        
                        const vagaEmpresa = document.createElement('p');
                        vagaEmpresa.textContent = vaga.empresa.nome;
                        vagaDiv.appendChild(vagaEmpresa);

                        vagaLink.appendChild(vagaDiv);
                        grid.appendChild(vagaLink);
                    });
                }

                function popularEmpresas() {
                    const selectEmpresa = document.getElementById('selectEmpresa');
                    const empresasUnicas = [...new Set(vagas.map(vaga => vaga.empresa.nome))];

                    empresasUnicas.forEach(empresaNome => {
                        const option = document.createElement('option');
                        option.textContent = empresaNome;
                        selectEmpresa.appendChild(option);
                    });
                }

                window.onload = getVagas();
                
            </script>

            <select id="selectPaginacao" onchange="vagaApp.mudarTamanho()">
                <option value="5">Exibir 5</option>
                <option value="10" selected>Exibir 10</option>
                <option value="20">Exibir 20</option>
                <option value="all">Ver Todas</option>
            </select>
            
        </section>

        <div id="ListaVagas" class="p-4"></div>
        
        <div id="vagasGrid" class="vagas-grid">
            </div>

        <footer class="pagination-footer">
            <button id="btnProximo" class="btn-glass">Próxima Página &rarr;</button>
        </footer>
    </div>

    <script src="js/api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</body>
</html>